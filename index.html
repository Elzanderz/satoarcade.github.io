<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>‡∏ã‡∏≤‡πÇ‡∏ï‡∏∞ ‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï - SATO ARCADE</title>
    
    <!-- Core Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>

    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;500;600;700&family=Orbitron:wght@700&family=Rajdhani:wght@600;700&display=swap" rel="stylesheet">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { 
                        'thai': ['"Noto Sans Thai"', 'sans-serif'],
                        'cyber': ['"Orbitron"', 'sans-serif'],
                        'tech': ['"Rajdhani"', 'sans-serif']
                    },
                    colors: { 
                        'brand-primary': '#4f46e5', // Indigo
                        'brand-secondary': '#8b5cf6', // Violet
                        'brand-accent': '#06b6d4', // Cyan
                        'glass': 'rgba(15, 23, 42, 0.9)',
                        'vip-silver': '#e2e8f0',
                        'vip-gold': '#fbbf24',
                        'vip-plat': '#22d3ee',
                    },
                    animation: {
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'pulse-slow': 'pulse 3s infinite',
                        'marquee': 'marquee 25s linear infinite',
                    },
                    keyframes: {
                        fadeIn: { '0%': { opacity: 0 }, '100%': { opacity: 1 } },
                        slideUp: { '0%': { transform: 'translateY(20px)', opacity: 0 }, '100%': { transform: 'translateY(0)', opacity: 1 } },
                        marquee: { '0%': { transform: 'translateX(100%)' }, '100%': { transform: 'translateX(-100%)' } }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #000000;
            color: #e2e8f0;
            font-family: 'Noto Sans Thai', sans-serif;
            overflow: hidden;
        }
        
        .cyber-grid-bg {
            position: fixed; inset: 0; z-index: -1;
            background-image: 
                linear-gradient(rgba(6, 182, 212, 0.05) 1px, transparent 1px),
                linear-gradient(90deg, rgba(6, 182, 212, 0.05) 1px, transparent 1px);
            background-size: 40px 40px;
            mask-image: radial-gradient(circle at center, black 40%, transparent 100%);
        }

        .glass-card {
            background: rgba(10, 10, 15, 0.85);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5);
        }

        .input-field {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            color: white;
            transition: all 0.3s;
        }
        .input-field:focus {
            border-color: #06b6d4;
            box-shadow: 0 0 10px rgba(6, 182, 212, 0.3);
            outline: none;
        }
        
        .custom-scroll::-webkit-scrollbar { width: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: #000; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #333; border-radius: 2px; }

        /* VIP & Frame Styles */
        .frame-neon { border: 2px solid #06b6d4; box-shadow: 0 0 10px #06b6d4; }
        .frame-gold { border: 2px solid #fbbf24; box-shadow: 0 0 10px #fbbf24; }
        .frame-cyber { border: 2px solid #8b5cf6; box-shadow: 0 0 10px #8b5cf6; border-radius: 0; }
        
        .vip-silver { color: #e2e8f0; }
        .vip-gold { color: #fbbf24; text-shadow: 0 0 5px rgba(251, 191, 36, 0.5); }
        .vip-platinum { color: #22d3ee; text-shadow: 0 0 10px rgba(34, 211, 238, 0.5); }
    </style>
</head>
<body>
    <div class="cyber-grid-bg"></div>
    <div id="root"></div>

    <script type="text/babel">
        // --- CONFIG ---
        const firebaseConfig = {
            apiKey: "", // Provided by environment usually, blank here for template
            authDomain: "bingo-sato.firebaseapp.com",
            projectId: "bingo-sato",
            storageBucket: "bingo-sato.firebasestorage.app",
            messagingSenderId: "348261448088",
            appId: "1:348261448088:web:61c19861c88b3c5094d3ed"
        };
        
        let finalConfig = firebaseConfig;
        if (typeof __firebase_config !== 'undefined') {
            try { finalConfig = JSON.parse(__firebase_config); } catch(e){}
        }
        
        if (!firebase.apps.length) firebase.initializeApp(finalConfig);
        const db = firebase.firestore();
        const auth = firebase.auth();
        const APP_ID = typeof __app_id !== 'undefined' ? __app_id : 'sato-ultimate-v3';

        const { useState, useEffect, useRef, useMemo } = React;

        // --- SOUND ENGINE ---
        const SoundEngine = {
            ctx: new (window.AudioContext || window.webkitAudioContext)(),
            play(type) {
                if (this.ctx.state === 'suspended') this.ctx.resume();
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.connect(gain); gain.connect(this.ctx.destination);
                const now = this.ctx.currentTime;
                
                switch(type) {
                    case 'hover':
                        osc.frequency.setValueAtTime(200, now); osc.frequency.linearRampToValueAtTime(300, now+0.05);
                        gain.gain.setValueAtTime(0.05, now); gain.gain.linearRampToValueAtTime(0, now+0.1);
                        break;
                    case 'click':
                        osc.type = 'square'; osc.frequency.setValueAtTime(400, now); osc.frequency.exponentialRampToValueAtTime(100, now+0.1);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now+0.1);
                        break;
                    case 'win':
                        osc.type = 'triangle'; osc.frequency.setValueAtTime(500, now); osc.frequency.linearRampToValueAtTime(1000, now+0.2);
                        gain.gain.setValueAtTime(0.1, now); gain.gain.linearRampToValueAtTime(0, now+0.4);
                        break;
                    case 'error':
                        osc.type = 'sawtooth'; osc.frequency.setValueAtTime(100, now);
                        gain.gain.setValueAtTime(0.2, now); gain.gain.linearRampToValueAtTime(0, now+0.3);
                        break;
                }
                osc.start(now); osc.stop(now+0.5);
            }
        };

        const Icon = ({ name, size = 20, className }) => <i data-lucide={name} className={className} style={{ width: size, height: size }}></i>;

        // --- SHOP ITEMS ---
        const SHOP_ITEMS = [
            { id: 'frame_neon', name: '‡∏Å‡∏£‡∏≠‡∏ö‡∏ô‡∏µ‡∏≠‡∏≠‡∏ô', type: 'frame', price: 2000, desc: '‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏£‡∏∑‡∏≠‡∏á‡πÅ‡∏™‡∏á‡∏™‡∏µ‡∏ü‡πâ‡∏≤', class: 'frame-neon' },
            { id: 'frame_gold', name: '‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏≠‡∏á‡∏Ñ‡∏≥', type: 'frame', price: 5000, desc: '‡∏Å‡∏£‡∏≠‡∏ö‡∏ó‡∏≠‡∏á‡∏´‡∏£‡∏π‡∏´‡∏£‡∏≤', class: 'frame-gold' },
            { id: 'frame_cyber', name: '‡∏Å‡∏£‡∏≠‡∏ö‡πÑ‡∏ã‡πÄ‡∏ö‡∏≠‡∏£‡πå', type: 'frame', price: 3000, desc: '‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏´‡∏•‡∏µ‡πà‡∏¢‡∏° Cyberpunk', class: 'frame-cyber' },
            { id: 'char_bot', name: '‡∏´‡∏∏‡πà‡∏ô‡∏¢‡∏ô‡∏ï‡πå‡∏ã‡∏≤‡πÇ‡∏ï‡∏∞', type: 'char', price: 1000, desc: '‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô', icon: 'ü§ñ' },
            { id: 'char_alien', name: '‡πÄ‡∏≠‡πÄ‡∏•‡∏µ‡πà‡∏¢‡∏ô', type: 'char', price: 2500, desc: '‡∏ï‡∏±‡∏ß‡∏•‡∏∞‡∏Ñ‡∏£‡∏ï‡πà‡∏≤‡∏á‡∏î‡∏≤‡∏ß', icon: 'üëΩ' },
            { id: 'char_cat', name: '‡πÅ‡∏°‡∏ß‡∏≠‡∏ß‡∏Å‡∏≤‡∏®', type: 'char', price: 4000, desc: '‡πÅ‡∏°‡∏ß‡∏ô‡πâ‡∏≠‡∏¢‡∏ô‡πà‡∏≤‡∏£‡∏±‡∏Å', icon: 'üê±' },
            { id: 'vip_silver', name: 'VIP ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô', type: 'vip', price: 10000, rank: 'SILVER', desc: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ VIP ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô' },
            { id: 'vip_gold', name: 'VIP ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏≠‡∏á', type: 'vip', price: 50000, rank: 'GOLD', desc: '‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ VIP ‡∏£‡∏∞‡∏î‡∏±‡∏ö‡∏ó‡∏≠‡∏á' },
        ];

        // --- AUTH COMPONENT (MODAL) ---
        const AuthModal = ({ onClose, onLogin, loading }) => {
            const [username, setUsername] = useState('');
            const [password, setPassword] = useState('');
            const isAdmin = username.toLowerCase() === 'admin';

            return (
                <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4 animate-fade-in">
                    <div className="w-full max-w-sm p-8 glass-card rounded-2xl animate-slide-up border border-brand-accent/20 relative overflow-hidden">
                        <div className="absolute top-0 right-0 p-4">
                            <button onClick={onClose} className="text-slate-400 hover:text-white">‚úï</button>
                        </div>
                        <div className="text-center mb-8">
                            <h1 className="text-4xl font-cyber font-bold text-transparent bg-clip-text bg-gradient-to-r from-brand-accent to-white tracking-tighter">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h1>
                            <p className="text-slate-500 text-xs font-thai mt-2">‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡πÄ‡∏Ç‡πâ‡∏≤‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô</p>
                        </div>
                        <form onSubmit={(e)=>{e.preventDefault(); onLogin(username, password)}} className="space-y-4">
                            <div className="relative group">
                                <Icon name="user" className="absolute left-3 top-3 text-slate-500 group-focus-within:text-brand-accent" size={18}/>
                                <input type="text" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô (Username)" className="input-field w-full pl-10 pr-4 py-3 rounded-lg font-thai text-sm" value={username} onChange={e=>setUsername(e.target.value)} autoFocus />
                            </div>
                            <div className={`transition-all duration-300 overflow-hidden ${isAdmin ? 'max-h-20 opacity-100' : 'max-h-0 opacity-0'}`}>
                                <input type="password" placeholder="‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡πÅ‡∏≠‡∏î‡∏°‡∏¥‡∏ô" className="input-field w-full pl-10 pr-4 py-3 rounded-lg font-mono text-sm border-red-500/50" value={password} onChange={e=>setPassword(e.target.value)} />
                            </div>
                            <button disabled={loading || !username} className="w-full py-3 bg-white text-black font-bold font-thai text-lg rounded-lg hover:bg-brand-accent hover:scale-[1.02] transition-all disabled:opacity-50">
                                {loading ? '‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏ä‡∏∑‡πà‡∏≠‡∏°‡∏ï‡πà‡∏≠...' : '‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô'}
                            </button>
                        </form>
                    </div>
                </div>
            );
        };

        // --- GAMES ---
        
        // 1. Bingo (Fixed Public Path & Removed OrderBy)
        const BingoLobby = ({ user, db, onExit, updateCredits }) => {
            const [rooms, setRooms] = useState([]);
            const [activeRoom, setActiveRoom] = useState(null);
            
            useEffect(() => {
                if(activeRoom) return;
                
                // FIX: Remove orderBy to prevent index errors in this environment
                // Fetch all and sort client-side
                const unsub = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('bingo_rooms')
                    .onSnapshot(
                        snap => {
                            const data = snap.docs.map(d => ({id:d.id, ...d.data()}));
                            // Client-side sort: newest first
                            data.sort((a,b) => (b.created?.seconds || 0) - (a.created?.seconds || 0));
                            setRooms(data.slice(0, 20)); // Limit client-side
                        },
                        error => {
                            console.error("Bingo Lobby Error:", error);
                        }
                    );
                return () => unsub();
            }, [activeRoom]);

            const createRoom = async () => {
                const name = prompt("‡∏ï‡∏±‡πâ‡∏á‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏Ç‡∏≠‡∏á‡∏Ñ‡∏∏‡∏ì:"); if(!name) return;
                try {
                    const ref = await db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('bingo_rooms').add({
                        name, host: user.username, created: firebase.firestore.FieldValue.serverTimestamp(), numbers: [], status: 'waiting'
                    });
                    setActiveRoom(ref.id);
                } catch(e) { console.error(e); alert("‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ: " + e.message); }
            };

            if(activeRoom) return <BingoRoom user={user} db={db} roomId={activeRoom} updateCredits={updateCredits} onLeave={()=>setActiveRoom(null)} />;

            return (
                <div className="h-full flex flex-col animate-slide-up">
                    <div className="flex justify-between items-center mb-6">
                        <h2 className="text-2xl font-thai font-bold text-brand-accent">‡∏´‡πâ‡∏≠‡∏á‡πÇ‡∏ñ‡∏á‡∏ö‡∏¥‡∏á‡πÇ‡∏Å</h2>
                        <button onClick={onExit} className="text-slate-400 hover:text-white flex items-center gap-1 text-sm"><Icon name="arrow-left" size={16}/> ‡∏Å‡∏•‡∏±‡∏ö</button>
                    </div>
                    <button onClick={createRoom} className="w-full py-4 mb-4 bg-gradient-to-r from-brand-primary to-brand-secondary rounded-xl font-bold font-thai text-white hover:scale-[1.01] transition-transform shadow-lg">+ ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà</button>
                    <div className="space-y-2 overflow-y-auto custom-scroll pr-2 flex-1">
                        {rooms.map(r => (
                            <div key={r.id} onClick={()=>setActiveRoom(r.id)} className="p-4 bg-white/5 border border-white/5 rounded-xl hover:border-brand-accent cursor-pointer flex justify-between items-center group">
                                <div>
                                    <div className="font-bold text-white group-hover:text-brand-accent font-thai">{r.name}</div>
                                    <div className="text-xs text-slate-500 font-thai">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á: {r.host}</div>
                                </div>
                                <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded font-thai">‡πÄ‡∏Ç‡πâ‡∏≤‡∏£‡πà‡∏ß‡∏°</span>
                            </div>
                        ))}
                        {rooms.length === 0 && <div className="text-center text-slate-500 mt-10 font-thai">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡πâ‡∏≠‡∏á... ‡∏™‡∏£‡πâ‡∏≤‡∏á‡πÄ‡∏•‡∏¢!</div>}
                    </div>
                </div>
            );
        };

        const BingoRoom = ({ user, db, roomId, updateCredits, onLeave }) => {
            const [gameState, setGameState] = useState(null);
            const [board, setBoard] = useState([]);
            
            useEffect(() => {
                const ref = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('bingo_rooms').doc(roomId);
                const unsub = ref.onSnapshot(
                    doc => { 
                        if(doc.exists) setGameState(doc.data()); 
                        else onLeave(); 
                    },
                    err => console.error("Room Error:", err)
                );
                return () => unsub();
            }, [roomId]);

            const drawNumber = async () => {
                if(!gameState) return;
                let num; do { num = Math.floor(Math.random()*75)+1; } while(gameState.numbers?.includes(num));
                await db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('bingo_rooms').doc(roomId).update({
                    numbers: firebase.firestore.FieldValue.arrayUnion(num), lastNumber: num, status: 'playing'
                });
            };

            const initBoard = () => {
                if(user.credits < 50) return alert("‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠!");
                updateCredits(-50);
                const newBoard = Array(5).fill(0).map((_,c) => {
                    const min=c*15+1; const nums=new Set();
                    while(nums.size<5) nums.add(Math.floor(Math.random()*(min+14-min+1))+min);
                    return Array.from(nums);
                });
                newBoard[2][2] = 'FREE';
                setBoard(newBoard);
            };

            if(!gameState) return <div>Loading...</div>;

            return (
                <div className="h-full flex flex-col">
                    <div className="flex justify-between items-center mb-4 pb-4 border-b border-white/10">
                        <button onClick={onLeave} className="text-xs text-slate-400 font-thai">‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á</button>
                        <div className="text-3xl font-bold text-brand-accent">{gameState.lastNumber || '--'}</div>
                        <div className="text-xs text-slate-400 font-thai">‡πÄ‡∏à‡πâ‡∏≤‡∏Ç‡∏≠‡∏á: {gameState.host}</div>
                    </div>
                    <div className="flex-1 flex flex-col items-center justify-center">
                        {board.length === 0 ? (
                            <div className="text-center">
                                <div className="text-6xl mb-4">üé´</div>
                                <button onClick={initBoard} className="px-8 py-3 bg-brand-accent text-black font-bold font-thai rounded-full hover:scale-105 transition-transform">‡∏ã‡∏∑‡πâ‡∏≠‡∏ï‡∏±‡πã‡∏ß (50 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï)</button>
                            </div>
                        ) : (
                            <div className="grid grid-cols-5 gap-2 w-full max-w-[320px]">
                                {['B','I','N','G','O'].map(l=><div key={l} className="text-center font-black text-brand-secondary">{l}</div>)}
                                {board.map((col, c) => col.map((n, r) => {
                                    const marked = n === 'FREE' || gameState.numbers?.includes(n);
                                    return <div key={`${c}-${r}`} className={`aspect-square flex items-center justify-center rounded font-bold ${marked?'bg-brand-primary text-white shadow-lg':'bg-white/5 text-slate-500'}`}>{n==='FREE'?'‚òÖ':n}</div>
                                }))}
                            </div>
                        )}
                    </div>
                    {user.username === gameState.host && (
                        <div className="mt-4"><button onClick={drawNumber} className="w-full py-4 bg-white text-black font-bold font-thai rounded-xl hover:bg-brand-accent">‡∏™‡∏∏‡πà‡∏°‡∏ï‡∏±‡∏ß‡πÄ‡∏•‡∏Ç</button></div>
                    )}
                </div>
            );
        };

        // 2. Memory Match
        const MemoryMatch = ({ updateCredits, onExit }) => {
            const [cards, setCards] = useState([]);
            const [turns, setTurns] = useState(0);
            const [level, setLevel] = useState(null); // 4 or 6
            const [flipped, setFlipped] = useState([]);
            const [solved, setSolved] = useState([]);

            const ICONS = ['üöÄ','üõ∏','üëæ','ü§ñ','üíé','‚ö°','üî•','üåü','üçÄ','üéµ','üéÆ','üïπÔ∏è','üíø','üíæ','üîã','üîß','üî®','‚öôÔ∏è'];

            const startGame = (size) => {
                const numPairs = (size * size) / 2;
                const gameIcons = ICONS.slice(0, numPairs);
                const deck = [...gameIcons, ...gameIcons].sort(()=>Math.random()-0.5).map((icon, id)=>({id, icon}));
                setCards(deck); setLevel(size); setTurns(0); setSolved([]); setFlipped([]);
            };

            const handleCardClick = (id) => {
                if(flipped.length === 2 || flipped.includes(id) || solved.includes(id)) return;
                const newFlipped = [...flipped, id];
                setFlipped(newFlipped);
                if(newFlipped.length === 2) {
                    setTurns(t=>t+1);
                    const [id1, id2] = newFlipped;
                    if(cards[id1].icon === cards[id2].icon) {
                        setSolved(prev => [...prev, id1, id2]);
                        setFlipped([]);
                        if(solved.length + 2 === cards.length) {
                            setTimeout(() => {
                                const reward = level === 4 ? 100 : 300;
                                updateCredits(reward);
                                alert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏î‡πâ‡∏ß‡∏¢! ‡∏Ñ‡∏∏‡∏ì‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö +${reward} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï`);
                                setLevel(null);
                            }, 500);
                        }
                    } else {
                        setTimeout(() => setFlipped([]), 1000);
                    }
                }
            };

            if(!level) return (
                <div className="h-full flex flex-col items-center justify-center gap-6 animate-slide-up">
                    <h2 className="text-3xl font-thai font-bold text-brand-secondary">‡πÄ‡∏Å‡∏°‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û</h2>
                    <div className="grid grid-cols-2 gap-4 w-full px-8">
                        <button onClick={()=>startGame(4)} className="p-6 bg-white/5 border border-white/10 rounded-xl hover:border-green-400 hover:text-green-400 transition-all">
                            <div className="text-xl font-bold font-thai">‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ</div>
                            <div className="text-xs text-slate-500 font-thai">‡∏ï‡∏≤‡∏£‡∏≤‡∏á 4x4</div>
                        </button>
                        <button onClick={()=>startGame(6)} className="p-6 bg-white/5 border border-white/10 rounded-xl hover:border-red-400 hover:text-red-400 transition-all">
                            <div className="text-xl font-bold font-thai">‡∏¢‡∏≤‡∏Å</div>
                            <div className="text-xs text-slate-500 font-thai">‡∏ï‡∏≤‡∏£‡∏≤‡∏á 6x6</div>
                        </button>
                    </div>
                    <button onClick={onExit} className="text-slate-500 hover:text-white mt-4 font-thai">‡∏≠‡∏≠‡∏Å</button>
                </div>
            );

            return (
                <div className="h-full flex flex-col items-center animate-fade-in">
                    <div className="flex justify-between w-full mb-4">
                        <button onClick={()=>setLevel(null)} className="text-xs text-slate-400 font-thai">‡∏¢‡∏≠‡∏°‡πÅ‡∏û‡πâ</button>
                        <div className="text-brand-accent font-thai">‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡∏Ñ‡∏£‡∏±‡πâ‡∏á: {turns}</div>
                    </div>
                    <div className={`grid gap-2 w-full max-w-[400px] aspect-square ${level===4?'grid-cols-4':'grid-cols-6'}`}>
                        {cards.map((c, i) => (
                            <div key={i} onClick={()=>handleCardClick(i)} className={`
                                rounded-lg flex items-center justify-center text-2xl cursor-pointer transition-all duration-300 transform
                                ${flipped.includes(i) || solved.includes(i) ? 'bg-brand-primary rotate-y-180 text-white' : 'bg-white/10 hover:bg-white/20 text-transparent'}
                            `}>
                                {(flipped.includes(i) || solved.includes(i)) ? c.icon : '?'}
                            </div>
                        ))}
                    </div>
                </div>
            );
        };

        // 3. Cyber Fly (Flappy Style)
        const CyberFly = ({ updateCredits, onExit }) => {
            const canvasRef = useRef(null);
            const [playing, setPlaying] = useState(false);
            const [score, setScore] = useState(0);
            const [difficulty, setDifficulty] = useState(null); // 'easy', 'hard'

            useEffect(() => {
                if(!playing) return;
                const cvs = canvasRef.current;
                const ctx = cvs.getContext('2d');
                let frames = 0;
                let bird = { x: 50, y: 150, v: 0, r: 10 };
                let pipes = [];
                let loopId;
                const gap = difficulty === 'hard' ? 80 : 120;
                const speed = difficulty === 'hard' ? 3 : 2;

                const loop = () => {
                    frames++;
                    ctx.fillStyle = '#000'; ctx.fillRect(0,0,300,400);
                    
                    // Bird
                    bird.v += 0.15; bird.y += bird.v;
                    ctx.fillStyle = '#06b6d4'; ctx.beginPath(); ctx.arc(bird.x, bird.y, bird.r, 0, Math.PI*2); ctx.fill();

                    // Pipes
                    if(frames % 120 === 0) {
                        let h = Math.random() * (400 - gap - 100) + 50;
                        pipes.push({ x: 300, top: h });
                    }
                    
                    for(let i=0; i<pipes.length; i++) {
                        let p = pipes[i];
                        p.x -= speed;
                        ctx.fillStyle = '#8b5cf6';
                        ctx.fillRect(p.x, 0, 40, p.top);
                        ctx.fillRect(p.x, p.top + gap, 40, 400 - p.top - gap);

                        if(p.x + 40 < 0) { pipes.shift(); i--; setScore(s=>s+1); }

                        // Collision
                        if(
                            bird.y - bird.r < 0 || bird.y + bird.r > 400 ||
                            (bird.x + bird.r > p.x && bird.x - bird.r < p.x + 40 &&
                            (bird.y - bird.r < p.top || bird.y + bird.r > p.top + gap))
                        ) {
                            setPlaying(false);
                            const reward = score * (difficulty==='hard'?10:5);
                            updateCredits(reward);
                            alert(`‡∏à‡∏ö‡πÄ‡∏Å‡∏°! ‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô: ${score} (+${reward} ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï)`);
                            cancelAnimationFrame(loopId);
                            return;
                        }
                    }
                    loopId = requestAnimationFrame(loop);
                };
                loopId = requestAnimationFrame(loop);
                
                const jump = () => bird.v = -3.5;
                cvs.addEventListener('click', jump);
                return () => { cvs.removeEventListener('click', jump); cancelAnimationFrame(loopId); }
            }, [playing]);

            if(!difficulty) return (
                <div className="h-full flex flex-col items-center justify-center gap-6 animate-slide-up">
                    <h2 className="text-3xl font-cyber text-brand-accent">CYBER FLY</h2>
                    <div className="flex gap-4">
                        <button onClick={()=>setDifficulty('easy')} className="px-6 py-3 bg-green-500/20 text-green-400 border border-green-500/50 rounded-xl hover:bg-green-500 hover:text-black font-thai">‡πÇ‡∏´‡∏°‡∏î‡∏á‡πà‡∏≤‡∏¢</button>
                        <button onClick={()=>setDifficulty('hard')} className="px-6 py-3 bg-red-500/20 text-red-400 border border-red-500/50 rounded-xl hover:bg-red-500 hover:text-white font-thai">‡πÇ‡∏´‡∏°‡∏î‡∏¢‡∏≤‡∏Å</button>
                    </div>
                    <button onClick={onExit} className="text-slate-500 text-xs font-thai">‡∏Å‡∏•‡∏±‡∏ö</button>
                </div>
            );

            return (
                <div className="h-full flex flex-col items-center">
                    {!playing ? (
                         <div className="text-center mt-20">
                             <div className="text-4xl font-bold text-white mb-4">{score}</div>
                             <button onClick={()=>{setScore(0); setPlaying(true)}} className="px-8 py-4 bg-white text-black font-bold rounded-full font-thai">‡πÅ‡∏ï‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°</button>
                             <div className="mt-4"><button onClick={()=>setDifficulty(null)} className="text-xs text-slate-400 font-thai">‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡πÇ‡∏´‡∏°‡∏î</button></div>
                         </div>
                    ) : (
                        <div className="relative">
                            <canvas ref={canvasRef} width="300" height="400" className="border border-white/10 rounded-xl bg-black"></canvas>
                            <div className="absolute top-2 left-2 text-white font-bold text-xl">{score}</div>
                        </div>
                    )}
                </div>
            );
        };

        // --- SHOP & INVENTORY ---
        const ShopModal = ({ user, updateCredits, equipItem, onClose, buyItem }) => {
            const [tab, setTab] = useState('shop'); // shop, inventory
            
            const inventory = user.inventory || [];
            const userItems = SHOP_ITEMS.filter(i => inventory.includes(i.id));

            return (
                <div className="fixed inset-0 z-50 bg-black/90 flex items-center justify-center p-4">
                    <div className="glass-card w-full max-w-2xl h-[80vh] flex flex-col rounded-2xl overflow-hidden">
                        <div className="flex p-4 border-b border-white/10">
                            <button onClick={()=>setTab('shop')} className={`flex-1 py-2 font-bold font-thai ${tab==='shop'?'text-brand-accent border-b-2 border-brand-accent':'text-slate-500'}`}>‡∏£‡πâ‡∏≤‡∏ô‡∏Ñ‡πâ‡∏≤</button>
                            <button onClick={()=>setTab('inventory')} className={`flex-1 py-2 font-bold font-thai ${tab==='inventory'?'text-brand-accent border-b-2 border-brand-accent':'text-slate-500'}`}>‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤</button>
                            <button onClick={onClose} className="px-4 text-slate-500">‚úï</button>
                        </div>
                        
                        <div className="flex-1 overflow-y-auto p-4 custom-scroll">
                            {tab === 'shop' ? (
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    {SHOP_ITEMS.map(item => {
                                        const owned = inventory.includes(item.id) || (item.type==='vip' && user.vipRank===item.rank);
                                        return (
                                            <div key={item.id} className="p-3 bg-white/5 border border-white/5 rounded-xl flex flex-col items-center text-center">
                                                <div className="text-3xl mb-2">{item.icon || 'üì¶'}</div>
                                                <div className="font-bold text-sm text-white font-thai">{item.name}</div>
                                                <div className="text-xs text-slate-400 mb-2 font-thai">{item.desc}</div>
                                                <button 
                                                    disabled={owned || user.credits < item.price}
                                                    onClick={()=>buyItem(item)}
                                                    className={`w-full py-1 text-xs font-bold rounded font-thai ${owned ? 'bg-slate-700 text-slate-500' : 'bg-brand-primary text-white hover:bg-brand-accent'}`}
                                                >
                                                    {owned ? '‡∏Ñ‡∏£‡∏≠‡∏ö‡∏Ñ‡∏£‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß' : `${item.price} ü™ô`}
                                                </button>
                                            </div>
                                        );
                                    })}
                                </div>
                            ) : (
                                <div className="grid grid-cols-2 md:grid-cols-3 gap-3">
                                    {userItems.map(item => (
                                        <div key={item.id} className="p-3 bg-white/5 border border-white/5 rounded-xl flex flex-col items-center text-center">
                                            <div className="text-3xl mb-2">{item.icon || 'üéí'}</div>
                                            <div className="font-bold text-sm text-white font-thai">{item.name}</div>
                                            {item.type !== 'vip' && (
                                                <button 
                                                    onClick={()=>equipItem(item.type, item.id)}
                                                    className={`mt-2 w-full py-1 text-xs font-bold rounded font-thai ${user.equipped?.[item.type] === item.id ? 'bg-green-500 text-black' : 'bg-white/10 hover:bg-white/20'}`}
                                                >
                                                    {user.equipped?.[item.type] === item.id ? '‡πÉ‡∏ä‡πâ‡∏≠‡∏¢‡∏π‡πà' : '‡πÉ‡∏ä‡πâ‡∏á‡∏≤‡∏ô'}
                                                </button>
                                            )}
                                        </div>
                                    ))}
                                    {userItems.length === 0 && <div className="col-span-3 text-center text-slate-500 mt-10 font-thai">‡πÑ‡∏°‡πà‡∏°‡∏µ‡πÑ‡∏≠‡πÄ‡∏ó‡∏°</div>}
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // --- MAIN APP ---
        const App = () => {
            const [user, setUser] = useState(null);
            const [page, setPage] = useState('home');
            const [loading, setLoading] = useState(true);
            const [showShop, setShowShop] = useState(false);
            const [showAuthModal, setShowAuthModal] = useState(false);
            const [authLoading, setAuthLoading] = useState(false);
            const [announcement, setAnnouncement] = useState('‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö‡∏™‡∏π‡πà ‡∏ã‡∏≤‡πÇ‡∏ï‡∏∞ ‡∏≠‡∏≤‡πÄ‡∏Ç‡∏ï ‚Ä¢ ‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏ü‡∏£‡∏µ‡∏ó‡∏∏‡∏Å‡∏ß‡∏±‡∏ô 100 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï ‚Ä¢ ‡πÄ‡∏Å‡∏°‡πÉ‡∏´‡∏°‡πà‡∏°‡∏≤‡πÅ‡∏•‡πâ‡∏ß!');

            useEffect(() => {
                if(window.lucide) window.lucide.createIcons();
                
                // FIX: Auth Priority Check to prevent "Permission Denied"
                const initAuth = async () => {
                    if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                        try {
                            await auth.signInWithCustomToken(__initial_auth_token);
                        } catch(e) { 
                            console.error("Token Auth Failed", e); 
                            if (!auth.currentUser) await auth.signInAnonymously();
                        }
                    } else {
                        if (!auth.currentUser) {
                            try { await auth.signInAnonymously(); } catch(e) { console.error("Anon Auth Failed", e); }
                        }
                    }
                };
                initAuth();

                const unsub = auth.onAuthStateChanged(async (u) => {
                    if (u) {
                        const ref = db.collection('artifacts').doc(APP_ID).collection('users').doc(u.uid).collection('profile').doc('userData');
                        
                        ref.onSnapshot(doc => {
                            if(doc.exists) {
                                setUser({uid: u.uid, ...doc.data()});
                            } else {
                                const guestData = {
                                    username: `‡∏ú‡∏π‡πâ‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°‡∏ä‡∏°_${Math.floor(Math.random()*999)}`,
                                    username_lower: `guest`,
                                    credits: 500, xp: 0, vipRank: 'NONE', role: 'guest',
                                    dailyReward: { count: 0 }, inventory: [], equipped: {}
                                };
                                ref.set(guestData);
                                setUser({uid: u.uid, ...guestData});
                            }
                            setLoading(false);
                        }, err => {
                            console.error("Profile Snapshot Error:", err);
                            // Fallback to stop loading spinner
                            setLoading(false);
                        });
                    }
                });
                return () => unsub();
            }, []);
            
            useEffect(() => { if(!loading && window.lucide) window.lucide.createIcons(); }, [page, loading, showShop]);

            const handleLogin = async (username, password) => {
                setAuthLoading(true);
                try {
                    if (!auth.currentUser) await auth.signInAnonymously();
                    const uid = auth.currentUser.uid;
                    const lowerUser = username.toLowerCase();
                    
                    if (lowerUser === 'admin' && password !== '1234') throw new Error('‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô‡∏ú‡∏¥‡∏î');

                    // NOTE: Removed complex queries here just in case, but keeping simple 'where' if supported
                    const dirRef = db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('users_directory');
                    const snap = await dirRef.where('username_lower', '==', lowerUser).limit(1).get();
                    
                    let newData = { 
                        username, username_lower: lowerUser, credits: 1000, xp: 0, vipRank: 'NONE', 
                        dailyReward: { count: 0, lastClaim: null }, inventory: [], equipped: {} 
                    };

                    if (!snap.empty) {
                        const d = snap.docs[0].data();
                        newData = { ...newData, credits: d.credits, xp: d.xp, vipRank: d.vipRank };
                    } else {
                        if (lowerUser === 'admin') newData = { ...newData, credits: 999999, vipRank: 'PLATINUM', role: 'admin' };
                    }

                    await db.collection('artifacts').doc(APP_ID).collection('users').doc(uid).collection('profile').doc('userData').set(newData, {merge: true});
                    // Only update directory if strict rules allow (public write might be restricted, but try)
                    try {
                        await dirRef.doc(uid).set({ username, username_lower: lowerUser, credits: newData.credits, xp: newData.xp, vipRank: newData.vipRank });
                    } catch(e) { console.warn("Public directory update skipped", e); }
                    
                    setShowAuthModal(false);
                    SoundEngine.play('win');
                    alert(`‡∏¢‡∏¥‡∏ô‡∏î‡∏µ‡∏ï‡πâ‡∏≠‡∏ô‡∏£‡∏±‡∏ö, ${username}!`);
                } catch(e) { alert(e.message); }
                finally { setAuthLoading(false); }
            };

            const updateCredits = (amt) => {
                if(!user) return;
                const newCreds = (user.credits || 0) + amt;
                db.collection('artifacts').doc(APP_ID).collection('users').doc(user.uid).collection('profile').doc('userData').update({ credits: newCreds });
                if(user.role !== 'guest') {
                    try {
                        db.collection('artifacts').doc(APP_ID).collection('public').doc('data').collection('users_directory').doc(user.uid).update({ credits: newCreds });
                    } catch(e) {}
                }
            };

            const buyItem = (item) => {
                if(user.credits < item.price) return alert("‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï‡πÑ‡∏°‡πà‡∏û‡∏≠");
                const updates = { credits: user.credits - item.price };
                if(item.type === 'vip') updates.vipRank = item.rank;
                else updates.inventory = firebase.firestore.FieldValue.arrayUnion(item.id);
                
                db.collection('artifacts').doc(APP_ID).collection('users').doc(user.uid).collection('profile').doc('userData').update(updates);
                alert(`‡∏ã‡∏∑‡πâ‡∏≠ ${item.name} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
            };

            const equipItem = (type, id) => {
                db.collection('artifacts').doc(APP_ID).collection('users').doc(user.uid).collection('profile').doc('userData').update({ [`equipped.${type}`]: id });
            };

            const handleDailyReward = () => {
                const now = new Date();
                const lastClaim = user.dailyReward?.lastClaim?.toDate() || new Date(0);
                const isSameDay = now.toDateString() === lastClaim.toDateString();
                let count = isSameDay ? (user.dailyReward?.count || 0) : 0;
                
                const timeDiff = now - lastClaim;
                if (isSameDay && timeDiff < 3600000) return alert(`‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏£‡∏≠‡∏≠‡∏µ‡∏Å ${Math.ceil((3600000 - timeDiff)/60000)} ‡∏ô‡∏≤‡∏ó‡∏µ`);
                
                if (count >= 5) return alert("‡∏Ñ‡∏£‡∏ö‡πÇ‡∏Ñ‡∏ß‡∏ï‡πâ‡∏≤‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ‡πÅ‡∏•‡πâ‡∏ß (5/5) ‡∏û‡∏£‡∏∏‡πà‡∏á‡∏ô‡∏µ‡πâ‡∏°‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏ô‡∏∞!");

                db.collection('artifacts').doc(APP_ID).collection('users').doc(user.uid).collection('profile').doc('userData').update({
                    credits: user.credits + 100,
                    'dailyReward.count': count + 1,
                    'dailyReward.lastClaim': firebase.firestore.FieldValue.serverTimestamp()
                });
                alert("‡∏£‡∏±‡∏ö‡πÅ‡∏•‡πâ‡∏ß 100 ‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï!");
            };

            if(loading) return <div className="min-h-screen flex items-center justify-center text-brand-accent font-thai animate-pulse text-2xl">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö...</div>;

            const frameClass = SHOP_ITEMS.find(i => i.id === user.equipped?.frame)?.class || 'border-white/20';
            const charIcon = SHOP_ITEMS.find(i => i.id === user.equipped?.char)?.icon || user.username.charAt(0);

            return (
                <div className="min-h-screen max-w-6xl mx-auto p-4 flex flex-col relative z-10">
                    <header className="glass-card p-4 rounded-2xl flex justify-between items-center mb-6 animate-fade-in">
                        <div className="flex items-center gap-4">
                            <div className={`w-14 h-14 rounded-xl bg-slate-900 flex items-center justify-center text-2xl font-bold ${frameClass}`}>
                                {charIcon}
                            </div>
                            <div>
                                <div className="font-thai text-xl text-white flex items-center gap-2 font-bold">
                                    {user.username} 
                                    {user.vipRank !== 'NONE' && <span className="text-[10px] bg-brand-primary px-2 rounded font-cyber">{user.vipRank}</span>}
                                </div>
                                <div className="text-xs text-slate-400 font-thai font-bold">‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï: {user.credits.toLocaleString()}</div>
                            </div>
                        </div>
                        <div className="flex gap-2 items-center">
                            <button onClick={()=>setShowAuthModal(true)} className="px-4 py-2 bg-brand-primary/20 text-brand-primary rounded-lg border border-brand-primary/50 text-xs font-bold hover:bg-brand-primary hover:text-white transition-all font-thai">
                                {user.role === 'guest' ? '‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö' : '‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏ö‡∏±‡∏ç‡∏ä‡∏µ'}
                            </button>
                            <button onClick={()=>setShowShop(true)} className="p-3 bg-white/5 rounded-xl hover:bg-brand-accent hover:text-black transition-all"><Icon name="shopping-bag"/></button>
                        </div>
                    </header>

                    <div className="w-full bg-brand-primary/10 border-y border-brand-primary/30 mb-6 overflow-hidden py-1">
                        <div className="whitespace-nowrap animate-marquee text-xs font-thai text-brand-accent font-bold">
                            {announcement}
                        </div>
                    </div>

                    <main className="flex-1">
                        {page === 'home' && (
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 animate-slide-up">
                                <div onClick={()=>setPage('bingo')} className="group relative h-64 rounded-3xl overflow-hidden cursor-pointer border border-white/10 hover:border-brand-accent transition-all">
                                    <div className="absolute inset-0 bg-gradient-to-t from-black to-transparent z-10"></div>
                                    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1518544806352-a228605200bd?auto=format&fit=crop&q=80')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110"></div>
                                    <div className="absolute bottom-0 left-0 p-6 z-20">
                                        <h3 className="text-3xl font-cyber text-white mb-1 group-hover:text-brand-accent transition-colors">BINGO</h3>
                                        <p className="text-sm text-slate-300 font-thai">‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡∏°‡∏ö‡∏¥‡∏á‡πÇ‡∏Å‡∏≠‡∏≠‡∏ô‡πÑ‡∏•‡∏ô‡πå</p>
                                    </div>
                                </div>

                                <div onClick={()=>setPage('runner')} className="group relative h-64 rounded-3xl overflow-hidden cursor-pointer border border-white/10 hover:border-brand-secondary transition-all">
                                    <div className="absolute inset-0 bg-gradient-to-t from-black to-transparent z-10"></div>
                                    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1550745165-9bc0b252726f?auto=format&fit=crop&q=80')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110"></div>
                                    <div className="absolute bottom-0 left-0 p-6 z-20">
                                        <h3 className="text-3xl font-cyber text-white mb-1 group-hover:text-brand-secondary transition-colors">CYBER FLY</h3>
                                        <p className="text-sm text-slate-300 font-thai">‡∏ö‡∏¥‡∏ô‡∏´‡∏•‡∏ö‡∏™‡∏¥‡πà‡∏á‡∏Å‡∏µ‡∏î‡∏Ç‡∏ß‡∏≤‡∏á</p>
                                    </div>
                                </div>

                                <div onClick={()=>setPage('memory')} className="group relative h-64 rounded-3xl overflow-hidden cursor-pointer border border-white/10 hover:border-green-400 transition-all">
                                    <div className="absolute inset-0 bg-gradient-to-t from-black to-transparent z-10"></div>
                                    <div className="absolute inset-0 bg-[url('https://images.unsplash.com/photo-1614728263952-84ea256f9679?auto=format&fit=crop&q=80')] bg-cover bg-center transition-transform duration-700 group-hover:scale-110"></div>
                                    <div className="absolute bottom-0 left-0 p-6 z-20">
                                        <h3 className="text-3xl font-cyber text-white mb-1 group-hover:text-green-400 transition-colors">MEMORY</h3>
                                        <p className="text-sm text-slate-300 font-thai">‡∏ù‡∏∂‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏à‡∏≥‡∏à‡∏±‡∏ö‡∏Ñ‡∏π‡πà‡∏†‡∏≤‡∏û</p>
                                    </div>
                                </div>

                                <div className="md:col-span-2 lg:col-span-3 grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div className="glass-card p-6 rounded-2xl flex items-center justify-between">
                                        <div>
                                            <h4 className="font-thai font-bold text-lg text-brand-accent">‡∏£‡∏±‡∏ö‡∏£‡∏≤‡∏á‡∏ß‡∏±‡∏•‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</h4>
                                            <p className="text-xs text-slate-500 font-thai">‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏∏‡∏Å‡πÄ‡∏ó‡∏µ‡πà‡∏¢‡∏á‡∏Ñ‡∏∑‡∏ô ‚Ä¢ ‡∏£‡∏±‡∏ö‡πÑ‡∏î‡πâ‡∏ó‡∏∏‡∏Å 1 ‡∏ä‡∏°.</p>
                                        </div>
                                        <button onClick={handleDailyReward} className="px-6 py-2 bg-white/5 border border-white/10 rounded-lg hover:bg-brand-accent hover:text-black transition-all font-bold text-sm font-thai">
                                            ‡∏£‡∏±‡∏ö (100)
                                        </button>
                                    </div>
                                    <div className="glass-card p-6 rounded-2xl flex items-center justify-between">
                                        <div>
                                            <h4 className="font-thai font-bold text-lg text-purple-400">‡∏≠‡∏±‡∏ô‡∏î‡∏±‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô</h4>
                                            <p className="text-xs text-slate-500 font-thai">‡∏™‡∏∏‡∏î‡∏¢‡∏≠‡∏î‡∏ú‡∏π‡πâ‡πÄ‡∏•‡πà‡∏ô‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ã‡∏µ‡∏ã‡∏±‡πà‡∏ô</p>
                                        </div>
                                        <div className="text-2xl font-bold text-white font-cyber">#1 CyberKing</div>
                                    </div>
                                </div>
                            </div>
                        )}

                        {page === 'bingo' && <BingoLobby user={user} db={db} onExit={()=>setPage('home')} updateCredits={updateCredits} />}
                        {page === 'runner' && <CyberFly onExit={()=>setPage('home')} updateCredits={updateCredits} />}
                        {page === 'memory' && <MemoryMatch onExit={()=>setPage('home')} updateCredits={updateCredits} />}
                    </main>

                    {showShop && <ShopModal user={user} updateCredits={updateCredits} equipItem={equipItem} buyItem={buyItem} onClose={()=>setShowShop(false)} />}
                    {showAuthModal && <AuthModal onClose={()=>setShowAuthModal(false)} onLogin={handleLogin} loading={authLoading} />}
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
